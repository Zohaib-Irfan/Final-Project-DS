<!doctype html>

<html>
  <style>
    /* 1. Remove browser defaults and ensure the page is the full viewport size */
html, body {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%; /* Important: Sets the height to 100% of the viewport */
    overflow: hidden; /* Prevents scrollbars from appearing */
}

/* 2. Style the Visualization Container */
#visualization-container {
    /* Use CSS Flexbox or Grid for easy internal alignment */
    display: flex; 
    flex-direction: column;
    
    /* Set container to take the remaining height */
    width: 100%;
    /* Calculate remaining height: 100vh - (height of header/controls) */
    height: calc(100vh - 80px); /* Adjust '80px' based on your header's actual height */
}

/* 3. Style the SVG Element itself */
#visualization {
    width: 100%;
    height: 100%;
}
  </style>
<head>
    <title>WebAssembly Linked List Visualizer</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body { font-family: sans-serif; }
        #visualization { border: 1px solid #ccc; background-color: #f7f7f7; }
        .node { transition: all 0.5s ease-out; }
        .node-circle { fill: #4CAF50; stroke: #388E3C; stroke-width: 2; }
        .node-text { fill: white; font-size: 16px; text-anchor: middle; dominant-baseline: central; }
        .pointer { stroke: #FF9800; stroke-width: 3; marker-end: url(#arrowhead); }
    </style>
</head>
<body>
  <div id="controls-header">
    <h1>Linked List Visualization (C++ Data)</h1>
    
    <button onclick="addNodeFromInput()">Add New Node</button>
    <input type="number" id="nodeValue" value="10" placeholder="Node Value" min="1">
    <p>Total Nodes: <span id="nodeCount">0</span></p>
  </div>
  <div id = "visualization-container">
    <svg id="visualization" width="800" height="300"></svg> 
  </div>
    <script src="visualgo.js"></script>

    <script>
        const svg = d3.select("#visualization");
        const node_size = 30;

        // Define the arrowhead marker for pointers
        svg.append("defs").append("marker")
            .attr("id", "arrowhead")
            .attr("viewBox", "0 0 10 10")
            .attr("refX", 10)
            .attr("refY", 5)
            .attr("markerWidth", 6)
            .attr("markerHeight", 6)
            .attr("orient", "auto-start-reverse")
            .append("path")
            .attr("d", "M 0 0 L 10 5 L 0 10 z")
            .attr("fill", "#FF9800");

        // --- JavaScript Function Called BY C++ ---
        // C++ calls this function to draw the node it just created.
        function drawNewNode(value, x, y, count) {
            console.log(`JS drawing node ${value} at (${x}, ${y})`);

            // 1. Draw the pointer from the new node to the old head
            if (count > 1) {
                // Line goes from the current new node back to the previous node's position
                const prevX = 100 + ((count - 2) * 120);
                
                svg.append("line")
                    .attr("class", "pointer")
                    .attr("x1", x + node_size) // Start from right edge of new node
                    .attr("y1", y)
                    .attr("x2", x + node_size)
                    .attr("y2", y)
                    .transition()
                    .duration(500)
                    .attr("x2", prevX - node_size) // End at left edge of previous node
                    .attr("y2", y)
            }
            
            // 2. Draw the Node Group (Circle and Text)
            const nodeGroup = svg.append("g")
                .attr("class", "node")
                .attr("transform", `translate(${x}, ${y})`)
                .style("opacity", 0); // Start invisible

            nodeGroup.append("circle")
                .attr("class", "node-circle")
                .attr("r", node_size);

            nodeGroup.append("text")
                .attr("class", "node-text")
                .text(value);

            // Animate fade-in
            nodeGroup.transition()
                .duration(500)
                .style("opacity", 1);
            
            // Update node count display
            d3.select("#nodeCount").text(Module.getNodeCount());
        }
        
        // --- JavaScript Function Called BY USER (onClick) ---
        // User clicks button, JS gets input, and calls C++
        function addNodeFromInput() {
            const input = document.getElementById("nodeValue");
            const value = parseInt(input.value);
            
            if (isNaN(value)) {
                alert("Please enter a valid number.");
                return;
            }
            
            // Call the C++ function exposed by Embind
            // C++ will handle the data structure update and call back drawNewNode()
            Module.addNode(value);
        }
    </script>
</body>
</html>